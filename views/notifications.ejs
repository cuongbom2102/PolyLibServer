<!DOCTYPE html>
<html>
<head>
    <title>PolyLib</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <style>
        .navbar {
            width: 80%;
            margin-left: 130px;
        }
        .row{
            width: 80%;
            margin-left: 130px;
            margin-top: 20px;
        }
        .date{
            margin-top: 20px;
        }
        .input{
            width: 370px;
            height: 40px;
            padding-left: 10px;
            border-radius: 10px;
            background-color: #F8F9FA;
            border: none;
        }
        #btn-revenue{
            width: 185px;
            height: 40px;
            border-radius: 5px;
            border: none;
            background-color: orange;
            color: white;

            margin-top: 20px;
        }
        #btn-revenue:hover{
            background-color: orangered;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #f2f2f2;
        }
        .alert-dialog {
            /* Thêm các thuộc tính CSS cho dialog */
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border: 1px solid #ccc;
            width: 50%;
            max-height: 80%;
            overflow-y: auto; /* Hiển thị thanh cuộn khi nội dung vượt quá kích thước */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            border-radius: 5px;
        }
        .close-button{
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 25px;
            border: none;
            float: left;
            background-color: orange;
        }
        .close-button:hover{
            background-color: orangered;
        }
        .alert-dialog-image{
            width: 20%;
            height: 200px;
            margin-top: 20px;
        }
        .head-wrapper{
            width: 100%;
            height: 40px;
            padding-top: 5px;
            border-bottom: 1px solid gray;
        }
        .text-title-head{
            font-size: 22px;
            text-align: center;
            margin-left: 280px;
            color: orangered;
            font-family: "Barlow Condensed";

        }
        .image-container{
            margin-left: 10px;
        }
        .text-wrapper{
            margin-left: 10px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .alert-dialog-text{
            font-size: 16px;
            font-style: italic;
        }
        .imgMember{
            width: 40px;
            height: 40px;
            border-radius: 25px;
            float: left;
        }
        .itemTextDate{
            font-size: 12px;
            margin-left: 5px;

        }
        .itemTextContent{
            margin-left: 5px;

        }
    </style>
</head>
<body class="container">
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a style="margin-left: 20px; font-size: 23px; font-weight: bold" class="nav-link active" aria-current="page" href="/index">PolyLib
        </a>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li  class="nav-item">
                    <a style="margin-left: 20px" class="nav-link" href="/index">Trang chủ
                    </a>
                </li>
                <li  class="nav-item">
                    <a style="margin-left: 20px" class="nav-link" href="/member">Thành viên
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="/" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Thống kê
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/top9BookBorrows">Thống kê top 9 sách mượn nhiều nhất</a></li>
                        <li><a class="dropdown-item" href="/top9BookSales">Thống kê top 9 sách bán nhiều nhất</a></li>
                        <li><a class="dropdown-item" href="/top9GoodsSales">Thống kê top 9 sản phẩm bán nhiều nhất</a></li>
                        <li><a class="dropdown-item" href="/top9Members">Thống kê top 9 thành viên hoạt động tích cực nhất</a></li>
                        <li><a class="dropdown-item" href="/revenue">Thống kê doanh thu</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="/" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Quản lý tài khoản
                    </a>
                    <ul class="dropdown-menu">
                        <% if (librarian.statusAdmin === '1') {%>
                            <li><a class="dropdown-item" href="/listLibrarian">Danh sách thủ thư</a></li>
                            <li><a class="dropdown-item" href="/Librarian">Tạo tài khoản cho thủ thư</a></li>
                        <% }%>
                            <li><a class="dropdown-item" href="/rules">Điều khoản</a></li>
                        <li><a class="dropdown-item" href="/changePassword">Đổi mật khẩu</a></li>
                        <li><a class="dropdown-item" href="index/logout">Đăng xuất</a></li>

                    </ul>
                </li>
                <li  class="nav-item">
                    <a style="margin-left: 20px" class="nav-link" href="/notifications">Thông báo
                    </a>
                </li>
                <li  class="nav-item">
                    <a style="margin-left: 20px" class="nav-link" href="/repliesFromUser">Phản hồi từ người dùng
                    </a>
                </li>

            </ul>
        </div>
    </div>
</nav>
<div class="row">
    <div class="col-3" style="border-right: 1px solid gray;; height: 770px">
        <h5 style="margin-top: 10px;margin-bottom: 10px">Quản lý sách</h5>
        <div class="list-group">
            <a href="/BookCategory" class="list-group-item list-group-item-action">Loại Sách</a>
            <a href="/Author" class="list-group-item list-group-item-action">Tác Giả </a>
            <a href="/Book" class="list-group-item list-group-item-action">Sách</a>
            <a href="/loanSlip" class="list-group-item list-group-item-action">Phiếu Mượn</a>
            <a href="/salesSlip" class="list-group-item list-group-item-action">Phiếu Bán</a>
        </div>

        <h5 style="margin-top: 10px;margin-bottom: 10px">Quản lý sản phẩm</h5>
        <div class="list-group">
            <a href="/goodsCategory" class="list-group-item list-group-item-action">Loại Sản Phẩm</a>
            <a href="/Goods" class="list-group-item list-group-item-action">Sản Phẩm </a>
            <a href="/Bill" class="list-group-item list-group-item-action">Hóa Đơn</a>
        </div>

        <div style="height: 320px;background-color: #F8F9FA;;margin-top: 20px;border-radius: 10px">
            <img style=" width: 100%; height: 50%;margin-top: 80px" src="uploads/image2.png">
        </div>

    </div>

    <div class="col-9" style="height: 600px">

        <h5>Thông báo đã được gửi đến thành viên</h5>
        <hr>
        <div class="ListNotifications" >
            <% const member = dataMember %>
            <% const librarians = dataLibrarian %>
            <% const libra = librarian %>
            <% const notifications = dataNotifications %>

            <% notifications.forEach((no) => { %>
                <div class="itemBook">
                    <% const member = dataMember.find(mem => mem._id.equals(no.member)); %>
                    <% const librarian = dataLibrarian.find(li => li._id.equals(no.librarian)); %>
                    <img class="imgMember" src="<%= librarian.image %>" alt="<%= librarian.fullname %>">
                    <div style="width: 100%;height: 100%">
                        <% if (libra._id === no.librarian){ %>
                            <% if (no.status === 0){%>
                                <em class="itemTextContent">Bạn đã gửi đến <%= member.fullName %> một thông báo hết hạn mượn sách</em>
                            <%}else {%>
                                <em class="itemTextContent">Bạn đã gửi đến <%= member.fullName %> một thông báo sắp hết hạn mượn sách</em>
                            <%}%>
                        <% }else {%>
                            <% if (no.status === 0){%>
                                <em class="itemTextContent"><%= librarian.fullname %> đã gửi đến <%= member.fullName %> một thông báo hết hạn mượn sách</em>
                            <%}else {%>
                                <em class="itemTextContent"><%= librarian.fullname %> đã gửi đến <%= member.fullName %> một thông báo sắp hết hạn mượn sách</em>
                            <%}%>
                        <%}%>
                        <br>
                        <% const currentDate = new Date(); %>
                        <% const noDateObj = new Date(no.notificationDate); %>
                        <% const timeDifference = currentDate - noDateObj; %>
                        <% const hoursDifference = Math.floor(timeDifference / (1000 * 60 * 60)); %>

                        <% if (hoursDifference >= 24 && hoursDifference <= 72) { %>
                            <% const daysDifference = Math.floor(hoursDifference / 24); %>
                            <em class="itemTextDate"><%= daysDifference %> ngày</em>
                        <% } else if (hoursDifference > 72) { %>
                            <% const date = new Date(no.notificationDate); %>
                            <% const day = date.getDate().toString().padStart(2, '0'); // Ngày %>
                            <% const month = (date.getMonth() + 1).toString().padStart(2, '0'); // Tháng (đánh số từ 0 - 11) %>
                            <% const year = date.getFullYear(); // Năm %>
                            <% const formattedDateBorrow = `${day}-${month}-${year}`; %>
                            <em class="itemTextDate"><%= formattedDateBorrow %></em>
                        <% } else if (hoursDifference === 0) { %>
                            <em class="itemTextDate">Vừa xong</em>
                        <% } else { %>
                            <em class="itemTextDate"><%= hoursDifference %> giờ</em>
                        <% } %>
                    </div>

                </div>
            <hr>
            <% }) %>
        </div>




    </div>

</div>
</body>
<script>
    function formatDate(dateText){
        if (dateText) {
            // Chuyển đổi từ chuỗi ISO 8601 sang định dạng yyyy-MM-dd
            var date = new Date(dateText);
            var day = date.getDate().toString().padStart(2, '0'); // Ngày
            var month = (date.getMonth() + 1).toString().padStart(2, '0'); // Tháng (đánh số từ 0 - 11)
            var year = date.getFullYear(); // Năm
            var formattedDateBorrow = `${day}-${month}-${year}`;
        }
        return formattedDateBorrow
    }
    function formatDateTrue(dateText){
        if (dateText) {
            // Chuyển đổi từ chuỗi ISO 8601 sang định dạng yyyy-MM-dd
            var date = new Date(dateText);
            var day = date.getDate().toString().padStart(2, '0'); // Ngày
            var month = (date.getMonth() + 1).toString().padStart(2, '0'); // Tháng (đánh số từ 0 - 11)
            var year = date.getFullYear(); // Năm
            var formattedDateBorrow = `${year}-${month}-${day}`;
        }
        return formattedDateBorrow
    }
    function formatDateDiff(commentDate) {
        const currentDate = new Date();
        const commentDateObj = new Date(commentDate);

        const timeDifference = currentDate - commentDateObj;
        const hoursDifference = Math.floor(timeDifference / (1000 * 60 * 60));

        if (hoursDifference >= 24 && hoursDifference <= 72) {
            const daysDifference = Math.floor(hoursDifference / 24);
            return daysDifference + ' ngày';
        }else if (hoursDifference > 72){
            return formatDate(commentDate);
        } else if (hoursDifference === 0){
            return 'Vừa xong';
        }
        else {
            return hoursDifference + ' giờ';
        }
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js" integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS" crossorigin="anonymous"></script>
</html>
